; Oh My Ondas - PlatformIO Configuration
; Build with: pio run
; Upload with: pio run --target upload

[platformio]
default_envs = teensy41
src_dir = teensy
include_dir = teensy/include
lib_dir = teensy/lib

; ============================================
; Teensy 4.1 - Main Processor
; ============================================
[env:teensy41]
platform = teensy
board = teensy41
framework = arduino

; Build flags
build_flags = 
    -D AUDIO_BLOCK_SAMPLES=128
    -D USB_AUDIO_SERIAL
    -D F_CPU=600000000
    -D DEBUG=1
    -O2

; Serial monitor
monitor_speed = 115200
monitor_port = /dev/ttyACM0

; Libraries
lib_deps = 
    ; Audio
    Audio
    Wire
    SPI
    SD
    SerialFlash
    
    ; Touch sensor
    adafruit/Adafruit MPR121@^1.1.1
    
    ; Display
    adafruit/Adafruit SSD1306@^2.5.7
    adafruit/Adafruit GFX Library@^1.11.9
    
    ; Encoders
    paulstoffregen/Encoder@^1.4.4
    
    ; LEDs
    adafruit/Adafruit NeoPixel@^1.12.0
    
    ; JSON for settings
    bblanchon/ArduinoJson@^6.21.4

; Extra scripts
extra_scripts = pre:scripts/version.py

; ============================================
; ESP32 - WiFi/GPS Module
; ============================================
[env:esp32]
platform = espressif32
board = esp32dev
framework = arduino

; ESP32 specific settings
board_build.flash_mode = dio
board_build.f_flash = 80000000L
board_build.partitions = default.csv

; Build flags
build_flags = 
    -D CORE_DEBUG_LEVEL=3
    -D CONFIG_ARDUHAL_LOG_COLORS=1

; Serial
monitor_speed = 115200
monitor_port = /dev/ttyUSB0

; Libraries
lib_deps = 
    ; WiFi
    WiFi
    HTTPClient
    WiFiClientSecure
    
    ; GPS
    mikalhart/TinyGPSPlus@^1.0.3
    
    ; JSON
    bblanchon/ArduinoJson@^6.21.4
    
    ; MQTT (optional)
    knolleary/PubSubClient@^2.8

; ============================================
; Common Settings
; ============================================
[env]
check_tool = clangtidy
check_flags = 
    clangtidy: --checks=-*,readability-*,bugprone-*

; Build type
build_type = release

; Upload settings
upload_protocol = custom
upload_command = teensy_loader_cli -mmcu=TEENSY41 -v $SOURCE
