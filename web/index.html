<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oh My Ondas - Interactive Hardware</title>
    <link rel="stylesheet" href="css/style.css?v=248">
    <style>
        :root {
            --bg: #f5f5f5;
            --accent: #ff6b2b;
            --green: #1aa167;
            --blue: #1270b8;
            --yellow: #ffc003;
            --pastel-gray: #ffffff;
            --gray-text: #555;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Main */
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(180deg, #f0f0f0 0%, #e8e8e8 100%);
        }

        /* Device - larger dimensions */
        .device-container { position: relative; width: 1100px; height: 700px; overflow: visible; }

        .enclosure {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 1080px;
            height: 670px;
            background: linear-gradient(165deg, #e8e8e8 0%, #d5d5d5 40%, #c8c8c8 100%);
            border-radius: 14px;
            border: 2px solid #bbb;
            box-shadow: 0 20px 60px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.8);
        }

        .enclosure::before {
            content: '';
            position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 10px;
            pointer-events: none;
        }

        /* Artwork */
        .artwork {
            position: absolute;
            top: 390px; left: 10px; right: 10px; bottom: 10px;
            opacity: 0.08;
            background-image: url('https://media.rhizome.org/blog/8979/Chombart-de-Lauwe.jpg');
            background-size: cover;
            border-radius: 8px;
            z-index: 0;
            pointer-events: none;
        }

        /* (panel backgrounds removed — simplified layout) */

        /* 5" Display (now iframe) */
        .display {
            position: absolute;
            top: 10px; left: 10px; right: 10px;
            height: 380px;
            background: #0a0a0a;
            border-radius: 6px;
            border: 2px solid #333;
            overflow: hidden;
            z-index: 2;
        }

        /* Section labels */
        .section-label {
            position: absolute;
            font-size: 8px;
            font-weight: 700;
            letter-spacing: 1px;
            z-index: 3;
        }
        .label-pads { top: 450px; left: 25px; color: var(--gray-text); }
        .label-ctrl { top: 450px; right: 25px; color: var(--gray-text); width: 200px; text-align: center; }

        /* 8 Touch Pads */
        .pads-container {
            position: absolute;
            top: 460px; left: 25px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 8px;
            width: 480px;
            height: 110px;
            z-index: 2;
        }

        .pad {
            background: linear-gradient(145deg, #f5f5f5 0%, #e0e0e0 100%);
            border-radius: 8px;
            border: 2px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        .pad:nth-child(1) { border-color: #ff6b2b; }
        .pad:nth-child(2) { border-color: #1270b8; }
        .pad:nth-child(3) { border-color: #1aa167; }
        .pad:nth-child(4) { border-color: #ffc003; }
        .pad:nth-child(5) { border-color: #ce2021; }
        .pad:nth-child(6) { border-color: #9b59b6; }
        .pad:nth-child(7) { border-color: #1270b8; }
        .pad:nth-child(8) { border-color: #ff6b2b; }

        .pad:hover { background: linear-gradient(145deg, #fff 0%, #eee 100%); }
        .pad:active, .pad.active {
            background: linear-gradient(145deg, #1aa167 0%, #148f57 100%);
            border-color: #1aa167;
            color: #fff;
        }

        .pad::before {
            content: '';
            position: absolute;
            top: 4px; right: 4px;
            width: 6px; height: 6px;
            border-radius: 50%;
            background: #ccc;
        }
        .pad.active::before { background: #fff; box-shadow: 0 0 6px #fff; }

        /* 4 Encoders */
        .encoders-container {
            position: absolute;
            top: 460px; right: 25px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            width: 200px;
            height: 110px;
            z-index: 2;
        }

        .encoder { display: flex; flex-direction: column; align-items: center; gap: 3px; }

        .encoder-knob {
            width: 36px; height: 36px;
            background: linear-gradient(145deg, #f5f5f5 0%, #ddd 100%);
            border-radius: 50%;
            border: 2px solid #bbb;
            position: relative;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .encoder-knob::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 14px; height: 14px;
            background: linear-gradient(145deg, #eee 0%, #ccc 100%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .encoder-knob::after {
            content: '';
            position: absolute;
            top: 4px; left: 50%;
            width: 3px; height: 8px;
            background: var(--accent);
            border-radius: 2px;
            transform: translateX(-50%);
        }

        .encoder-indicator {
            position: absolute;
            top: 4px; left: 50%;
            width: 3px; height: 8px;
            background: var(--accent);
            border-radius: 2px;
            transform-origin: center 14px;
        }

        .encoder-label { font-size: 9px; color: var(--gray-text); font-weight: 600; }
        .encoder-value { font-size: 8px; color: #666; font-family: monospace; }

        /* (LEDs removed — simplified layout) */

        /* Transport */
        .transport-container {
            position: absolute;
            bottom: 18px; left: 25px;
            display: flex;
            gap: 10px;
            z-index: 2;
        }

        .transport-btn {
            width: 38px; height: 38px;
            background: linear-gradient(145deg, #f5f5f5 0%, #ddd 100%);
            border-radius: 50%;
            border: 2px solid #bbb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
            cursor: pointer;
        }

        .transport-btn:hover { background: linear-gradient(145deg, #fff 0%, #eee 100%); }
        .transport-btn.play.active { background: #1aa167; color: #fff; border-color: #1aa167; }
        .transport-btn.rec.active, .transport-btn.rec.rec-active { background: #ce2021; color: #fff; border-color: #ce2021; }

        /* (Scenes removed — lives on touchscreen) */

        /* I/O */
        .io-ports {
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .io-port {
            width: 16px; height: 16px;
            background: #999;
            border-radius: 50%;
            border: 2px solid #777;
        }

        /* Info bar */
        .info-bar {
            background: #fff;
            padding: 8px 16px;
            display: flex;
            justify-content: center;
            gap: 24px;
            color: #888;
            font-size: 11px;
            border-top: 1px solid #e0e0e0;
        }
        .info-bar span { color: #1aa167; font-weight: 600; }

        /* Menu overlay */
        .menu-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 20px;
        }
        .menu-overlay.open { display: flex; }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        .menu-title { color: #1aa167; font-size: 18px; font-weight: 700; }
        .menu-close {
            width: 40px; height: 40px;
            background: #ff6b2b;
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px 0;
            flex: 1;
            align-content: start;
        }

        .menu-item {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 2px solid #333;
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .menu-item:hover { border-color: #1aa167; transform: scale(1.02); }

        .menu-icon { font-size: 32px; margin-bottom: 8px; }
        .menu-label { color: #fff; font-size: 14px; font-weight: 600; }
        .menu-sublabel { color: #666; font-size: 10px; margin-top: 4px; }

        /* (Source panel, mode panel, focus indicator, AI orchestration, mic meter removed — simplified layout) */

        /* 3 Mode Buttons Bar */
        .modes-bar {
            position: absolute;
            top: 400px; left: 25px; right: 25px;
            height: 46px;
            display: flex;
            gap: 10px;
            z-index: 2;
        }
        .mode-btn {
            flex: 1;
            height: 40px;
            border-radius: 6px;
            border: 2px solid;
            font-size: 12px;
            font-weight: 800;
            letter-spacing: 1.5px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.15s;
        }
        .mode-btn[data-mode="picture"] {
            border-color: #ff6b2b;
            background: transparent;
            color: #ff6b2b;
        }
        .mode-btn[data-mode="picture"].active {
            background: #ff6b2b;
            color: #fff;
        }
        .mode-btn[data-mode="soundscape"] {
            border-color: #1aa167;
            background: transparent;
            color: #1aa167;
        }
        .mode-btn[data-mode="soundscape"].active {
            background: #1aa167;
            color: #fff;
        }
        .mode-btn[data-mode="interact"] {
            border-color: #1270b8;
            background: transparent;
            color: #1270b8;
        }
        .mode-btn[data-mode="interact"].active {
            background: #1270b8;
            color: #fff;
        }
        .mode-btn:hover { opacity: 0.85; }

        /* GPS Strip (compact, bottom-right) */
        .gps-strip {
            position: absolute;
            bottom: 18px; right: 25px;
            width: 200px; height: 45px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            z-index: 2;
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 8px;
        }
        .gps-strip .gps-icon {
            font-size: 16px;
            color: var(--accent);
            flex-shrink: 0;
        }
        .gps-strip .gps-info {
            display: flex;
            flex-direction: column;
            gap: 1px;
            overflow: hidden;
        }
        .gps-strip .gps-label {
            font-size: 8px;
            font-weight: 700;
            color: var(--gray-text);
            letter-spacing: 1px;
        }
        .gps-strip .gps-coords {
            font-size: 9px;
            color: #888;
            font-family: monospace;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Menu button on display */
        .menu-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 3px;
            z-index: 5;
        }
        .menu-btn span {
            width: 12px;
            height: 2px;
            background: #888;
            border-radius: 1px;
        }
        .menu-btn:hover { background: #444; }
        .menu-btn:hover span { background: #1aa167; }

        /* (Radio indicator, map-display removed — simplified layout) */

        /* External Sensor Diagrams — Electric Blueprint Style */
        .sensor {
            position: absolute;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 0;
        }
        .sensor-icon {
            width: 32px; height: 32px;
            border: 2px solid #1270b8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: #1a1a1a;
            color: #fff;
            flex-shrink: 0;
        }
        .sensor-info {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }
        .sensor-name {
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #1270b8;
        }
        .sensor-desc {
            font-size: 8px;
            color: #666;
        }

        /* Wire lines — solid colored */
        .sensor-line {
            position: absolute;
            border-top: 2px solid #1270b8;
        }
        .sensor-line-v {
            position: absolute;
            border-left: 2px solid #1270b8;
        }

        /* Junction dots — where wires meet the device */
        .sensor-line::after,
        .sensor-line-v::after {
            content: '';
            position: absolute;
            width: 8px; height: 8px;
            background: currentColor;
            border-radius: 50%;
        }
        .sensor-line::after {
            right: -4px; top: -5px;
        }
        .sensor-line-v::after {
            bottom: -4px; left: -5px;
        }

        /* Per-sensor wire colors */
        .sensor-piezo .sensor-icon { border-color: #ff6b2b; }
        .sensor-piezo .sensor-name { color: #ff6b2b; }
        .sensor-piezo .sensor-line { border-color: #ff6b2b; color: #ff6b2b; }

        .sensor-mic .sensor-icon { border-color: #1aa167; }
        .sensor-mic .sensor-name { color: #1aa167; }
        .sensor-mic .sensor-line { border-color: #1aa167; color: #1aa167; }

        .sensor-wifi .sensor-icon { border-color: #ffc003; }
        .sensor-wifi .sensor-name { color: #ffc003; }
        .sensor-wifi .sensor-line-v { border-color: #ffc003; color: #ffc003; }

        .sensor-radio .sensor-icon { border-color: #1270b8; }
        .sensor-radio .sensor-name { color: #1270b8; }
        .sensor-radio .sensor-line-v { border-color: #1270b8; color: #1270b8; }

        /* Sensor positions */
        .sensor-piezo { top: 200px; left: -190px; }
        .sensor-piezo .sensor-line { top: 16px; left: 145px; width: 35px; }

        .sensor-mic { top: 320px; left: -190px; }
        .sensor-mic .sensor-line { top: 16px; left: 145px; width: 35px; }

        .sensor-wifi { top: -55px; left: 200px; flex-direction: column; }
        .sensor-wifi .sensor-line-v { top: 42px; left: 15px; height: 23px; }

        .sensor-radio { top: -55px; right: 200px; left: auto; flex-direction: column; }
        .sensor-radio .sensor-line-v { top: 42px; left: 15px; height: 23px; }

        /* Corner bend pieces — L-shaped wire segments */
        .sensor-piezo .sensor-line::before,
        .sensor-mic .sensor-line::before {
            content: '';
            position: absolute;
            right: -2px; top: -12px;
            width: 0; height: 12px;
            border-left: 2px solid;
        }
        .sensor-piezo .sensor-line::before { border-color: #ff6b2b; }
        .sensor-mic .sensor-line::before { border-color: #1aa167; }

        /* I/O port labels — electric blueprint style */
        .io-label {
            position: absolute;
            right: -160px;
            font-size: 9px;
            font-weight: 800;
            color: #ce2021;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        .io-label-line {
            position: absolute;
            right: -25px;
            width: 25px;
            border-top: 2px solid #ce2021;
        }
        /* Terminal markers on I/O lines */
        .io-label-line::after {
            content: '';
            position: absolute;
            right: -1px; top: -4px;
            width: 6px; height: 6px;
            background: #ce2021;
        }
        .io-port {
            border-color: #ce2021;
        }
    </style>
</head>
<body>
    <header class="page-header">
        <a href="index.html" class="logo">OH MY ONDAS</a>
        <nav class="nav-links">
            <a href="index.html" class="nav-link active">Home</a>
            <a href="app.html" class="nav-link">App</a>
            <a href="design.html" class="nav-link">Design</a>
            <a href="sdlc.html" class="nav-link">SDLC</a>
            <a href="about.html" class="nav-link">About</a>
            <a href="analysis.html" class="nav-link">Analysis</a>
        </nav>
    </header>

    <!-- Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay">
        <div class="menu-header">
            <div class="menu-title">MODULE SELECT</div>
            <button class="menu-close" id="menuClose">&times;</button>
        </div>
        <div class="menu-grid">
            <div class="menu-item" data-module="sampler">
                <div class="menu-icon">&#x1F941;</div>
                <div class="menu-label">SAMPLER</div>
                <div class="menu-sublabel">8 Pads</div>
            </div>
            <div class="menu-item" data-module="synth">
                <div class="menu-icon">&#x1F3B9;</div>
                <div class="menu-label">SYNTH</div>
                <div class="menu-sublabel">Dual OSC</div>
            </div>
            <div class="menu-item" data-module="radio">
                <div class="menu-icon">&#x1F4FB;</div>
                <div class="menu-label">RADIO</div>
                <div class="menu-sublabel">GPS Stations</div>
            </div>
            <div class="menu-item" data-module="fx">
                <div class="menu-icon">&#x2728;</div>
                <div class="menu-label">FX</div>
                <div class="menu-sublabel">Delay / Glitch / Grain</div>
            </div>
            <div class="menu-item" data-module="ai">
                <div class="menu-icon">&#x1F916;</div>
                <div class="menu-label">AI COMPOSER</div>
                <div class="menu-sublabel">Soundscape Aware</div>
            </div>
            <div class="menu-item" data-module="orchestrate">
                <div class="menu-icon">&#x1F3AD;</div>
                <div class="menu-label">AI ORCHESTRATE</div>
                <div class="menu-sublabel">Full Auto Mode</div>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="device-container">
            <div class="enclosure">
                <div class="artwork"></div>

                <!-- 5" Touch Display (iframe) -->
                <div class="display">
                    <!-- Menu Button -->
                    <div class="menu-btn" id="menuBtn">
                        <span></span><span></span><span></span>
                    </div>
                    <iframe id="appDisplay"
                            src="app.html?embedded=1"
                            allow="autoplay; microphone"
                            style="width: 100%; height: 100%; border: none; border-radius: 4px; background: #111;">
                    </iframe>
                </div>

                <!-- 3 Mode Buttons -->
                <div class="modes-bar">
                    <button class="mode-btn active" data-mode="picture">PICTURE</button>
                    <button class="mode-btn" data-mode="soundscape">SOUNDSCAPE</button>
                    <button class="mode-btn" data-mode="interact">INTERACT</button>
                </div>

                <!-- Labels -->
                <span class="section-label label-pads">PADS</span>
                <span class="section-label label-ctrl">CTRL</span>

                <!-- 8 Touch Pads -->
                <div class="pads-container" id="padsContainer">
                    <div class="pad" data-pad="0">1</div>
                    <div class="pad" data-pad="1">2</div>
                    <div class="pad" data-pad="2">3</div>
                    <div class="pad" data-pad="3">4</div>
                    <div class="pad" data-pad="4">5</div>
                    <div class="pad" data-pad="5">6</div>
                    <div class="pad" data-pad="6">7</div>
                    <div class="pad" data-pad="7">8</div>
                </div>

                <!-- 4 Encoders -->
                <div class="encoders-container">
                    <div class="encoder" data-param="volume">
                        <div class="encoder-knob" data-value="80">
                            <div class="encoder-indicator"></div>
                        </div>
                        <span class="encoder-label">VOL</span>
                        <span class="encoder-value">80</span>
                    </div>
                    <div class="encoder" data-param="pan">
                        <div class="encoder-knob" data-value="50">
                            <div class="encoder-indicator"></div>
                        </div>
                        <span class="encoder-label">PAN</span>
                        <span class="encoder-value">C</span>
                    </div>
                    <div class="encoder" data-param="filter">
                        <div class="encoder-knob" data-value="100">
                            <div class="encoder-indicator"></div>
                        </div>
                        <span class="encoder-label">FILT</span>
                        <span class="encoder-value">100</span>
                    </div>
                    <div class="encoder" data-param="fx">
                        <div class="encoder-knob" data-value="0">
                            <div class="encoder-indicator"></div>
                        </div>
                        <span class="encoder-label">FX</span>
                        <span class="encoder-value">0</span>
                    </div>
                </div>

                <!-- Transport (3 buttons) -->
                <div class="transport-container">
                    <div class="transport-btn play" data-action="play">&#9654;</div>
                    <div class="transport-btn stop" data-action="stop">&#9632;</div>
                    <div class="transport-btn rec" data-action="rec">&#9679;</div>
                </div>

                <!-- GPS Strip (compact, bottom-right) -->
                <div class="gps-strip" id="gpsStrip">
                    <div class="gps-icon">+</div>
                    <div class="gps-info">
                        <span class="gps-label">GPS</span>
                        <span class="gps-coords" id="gpsCoords">--</span>
                    </div>
                </div>
            </div>

            <!-- I/O Ports with labels -->
            <div class="io-ports">
                <div style="position: relative;">
                    <div class="io-port" title="Audio Out"></div>
                    <div class="io-label" style="top: 2px;">Audio Out</div>
                    <div class="io-label-line" style="top: 8px;"></div>
                </div>
                <div style="position: relative;">
                    <div class="io-port" title="Headphones"></div>
                    <div class="io-label" style="top: 2px;">Headphones</div>
                    <div class="io-label-line" style="top: 8px;"></div>
                </div>
                <div style="position: relative;">
                    <div class="io-port" title="Audio In"></div>
                    <div class="io-label" style="top: 2px;">Audio In</div>
                    <div class="io-label-line" style="top: 8px;"></div>
                </div>
            </div>

            <!-- External Sensor Diagrams -->
            <div class="sensor sensor-piezo">
                <div class="sensor-icon">&#9676;</div>
                <div class="sensor-info">
                    <span class="sensor-name">Piezo</span>
                    <span class="sensor-desc">Vibration sensor</span>
                </div>
                <div class="sensor-line"></div>
            </div>
            <div class="sensor sensor-mic">
                <div class="sensor-icon">&#9834;</div>
                <div class="sensor-info">
                    <span class="sensor-name">Mic</span>
                    <span class="sensor-desc">Condenser</span>
                </div>
                <div class="sensor-line"></div>
            </div>
            <div class="sensor sensor-wifi">
                <div class="sensor-icon">&#8801;</div>
                <div class="sensor-info">
                    <span class="sensor-name">WiFi</span>
                    <span class="sensor-desc">802.11</span>
                </div>
                <div class="sensor-line-v"></div>
            </div>
            <div class="sensor sensor-radio">
                <div class="sensor-icon">&#9399;</div>
                <div class="sensor-info">
                    <span class="sensor-name">Radio</span>
                    <span class="sensor-desc">FM Antenna</span>
                </div>
                <div class="sensor-line-v"></div>
            </div>
        </div>
    </main>

    <div class="info-bar">
        <div>Enclosure: <span>200x140x45mm</span></div>
        <div>Display: <span>5" Touch</span></div>
        <div>Pads: <span>8x MPR121</span></div>
        <div>Encoders: <span>4x Rotary</span></div>
        <div>Time: <span id="timeVal">--:--</span></div>
    </div>

    <footer class="page-footer">
        <span>Oh My Ondas v2.5.2</span>
        <span>GPL-3.0 License</span>
        <a href="https://github.com/alevm/oh-my-ondas">GitHub</a>
    </footer>

    <script>
    (function() {
        const appFrame = document.getElementById('appDisplay');
        let appState = {};

        function sendToApp(action, data) {
            if (appFrame && appFrame.contentWindow) {
                appFrame.contentWindow.postMessage({ type: 'mockup-control', action, data }, '*');
            }
        }

        // Receive messages from embedded app
        window.addEventListener('message', (event) => {
            if (!event.data) return;

            if (event.data.type === 'app-state') {
                appState = event.data.data;
                updateMockupFromState(appState);
            }

            if (event.data.type === 'encoder-context') {
                updateEncoderLabels(event.data.data);
            }
        });

        function updateEncoderLabels(ctx) {
            if (!ctx || !ctx.encoders) return;
            const encoders = document.querySelectorAll('.encoder');
            ctx.encoders.forEach((label, i) => {
                if (encoders[i]) {
                    const labelEl = encoders[i].querySelector('.encoder-label');
                    if (labelEl) labelEl.textContent = label;
                }
            });
        }

        function updateMockupFromState(state) {
            // Update transport button states
            const playBtn = document.querySelector('.transport-btn.play');
            if (playBtn) playBtn.classList.toggle('active', state.isPlaying);

            const recBtn = document.querySelector('.transport-btn.rec');
            if (recBtn) recBtn.classList.toggle('rec-active', state.isRecording);

            // Update GPS coords
            const gpsCoords = document.getElementById('gpsCoords');
            if (gpsCoords && state.gps) gpsCoords.textContent = state.gps;

            // Sync mode buttons with app state
            if (state.mode) {
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.mode === state.mode);
                });
            }
        }

        // Transport buttons
        document.querySelectorAll('.transport-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.classList.contains('play') ? 'play' :
                              btn.classList.contains('stop') ? 'stop' : 'record';
                sendToApp('transport', { action });
                if (action === 'play') btn.classList.toggle('active');
                if (action === 'record') btn.classList.toggle('rec-active');
            });
        });

        // Pads
        document.querySelectorAll('.pad').forEach(pad => {
            const trigger = () => {
                pad.classList.add('active');
                sendToApp('pad', { index: parseInt(pad.dataset.pad) });
            };
            const release = () => pad.classList.remove('active');
            pad.addEventListener('mousedown', trigger);
            pad.addEventListener('touchstart', (e) => { e.preventDefault(); trigger(); });
            pad.addEventListener('mouseup', release);
            pad.addEventListener('mouseleave', release);
            pad.addEventListener('touchend', release);
        });

        // Encoders — drag vertically to change value, forwards to app
        document.querySelectorAll('.encoder').forEach(enc => {
            let startY = 0, startVal = 50;
            const param = enc.dataset.param;
            const knob = enc.querySelector('.encoder-knob');

            const onMove = (clientY) => {
                const delta = (startY - clientY) * 0.5;
                const val = Math.max(0, Math.min(100, startVal + delta));
                const rounded = Math.round(val);

                // Update visual indicator
                const indicator = enc.querySelector('.encoder-indicator');
                if (indicator) {
                    indicator.style.transform = 'rotate(' + (val * 2.7 - 135) + 'deg)';
                }

                // Update displayed value
                const valEl = enc.querySelector('.encoder-value');
                if (valEl) valEl.textContent = rounded;

                // Store current value
                if (knob) knob.dataset.value = rounded;

                sendToApp('encoder', { param, value: rounded });
            };

            enc.addEventListener('mousedown', (e) => {
                startY = e.clientY;
                startVal = parseInt(knob?.dataset.value || 50);
                const move = (e2) => onMove(e2.clientY);
                const up = () => { document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); };
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', up);
            });
        });

        // Mode buttons (PICTURE, SOUNDSCAPE, INTERACT)
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                sendToApp('mode', { mode: btn.dataset.mode });
            });
        });

        // Keyboard shortcuts forwarding
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ') { e.preventDefault(); sendToApp('transport', { action: 'play' }); }
            if (e.key >= '1' && e.key <= '8') { sendToApp('pad', { index: parseInt(e.key) - 1 }); }
            if (e.key === 'Escape') { sendToApp('transport', { action: 'stop' }); }
        });

        // Time display
        function updateTime() {
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
            const el = document.getElementById('timeVal');
            if (el) el.textContent = timeStr;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Menu overlay toggle (keep from prototype.html)
        const menuOverlay = document.getElementById('menuOverlay');
        const menuBtn = document.getElementById('menuBtn');
        const menuClose = document.getElementById('menuClose');
        if (menuBtn && menuOverlay) {
            menuBtn.addEventListener('click', () => menuOverlay.classList.toggle('open'));
        }
        if (menuClose && menuOverlay) {
            menuClose.addEventListener('click', () => menuOverlay.classList.remove('open'));
        }
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Tab' && menuOverlay) { e.preventDefault(); menuOverlay.classList.toggle('open'); }
        });
    })();
    </script>
</body>
</html>
